# MyLocationApp  
キャノボ用GPS連携ツイート補助アプリ  

### Overview  
自転車による東京大阪キャノンボールのために作った、Android専用のGPS連動型ツイッター投稿補助アプリです。  
一定周期でバックグラウンドサービスからGPSを呼び出し、あらかじめ準備した座標の半径内に入っていれば最新の移動履歴を更新します。  
画面上でボタンを押すと最新の移動履歴を取得して表示します。  
この時、直前の履歴と異なる場合のみ定型文をツイートするためのREST APIをコールします。  
**現時点ではAndroid開発をしたことのない方には無用の長物です！**

### Specifications  
技術力のないガチガチのSIerが3日で作ったアプリです。  
「えーマジ単体テストなし！？ビッグバンテストが許されるのはUNIXエポック0秒までだよねー」という方はご遠慮ください。  

+ バックグラウンドサービスが3分ごとにGPSの座標を取得して、あらかじめ作成済みの座標ピンのリストをループでぶんまわす
  - GPS更新時間を上書きする
  - 現在の座標から半径1キロ以内に座標ピンがあれば、到着時刻と最新の移動履歴を更新
+ 画面下のボタンを押したときにGPS更新時間と最新の移動履歴を表示
  - 直前の履歴と異なる場合、座標ピンの名称・走行距離・到着目標/到着時刻を表示
  - さらに `https://twitter.com/share?text=本文` のように平易なREST APIを呼び出してTwitterアプリと連動させる

### How to run
動かすためには、Android Studioが必要です。(Android Studio 2.3.3/JRE-1.8.0_112/Windows10 64bitで開発)  
また、Androidは7.1.1以上(Nougat)で動作確認しています。ターゲットフレームワークも同様です。  
おそらくある程度枯れたネイティブ機能のAPIのみ使っているはずですが、どのバージョンまで遡って動作するかは未検証です。  
  
座標ピンのリストはMyLocationListener.javaのソースに直書きしています。  
**このままでは拡張性が一切ないので、現バージョンの.apkの作成や配布は行いません。**

### Others
MainActivity.javaなどに、Twitter4jを使用しようとした残骸が残っています。  
エミュレータでは動作しましたが、実機で動作しなかったので自動ツイートを断念しています。  
  
フォークして開発したい奇特な方は `build.gradle` に下記のようなコードを追加し、javaファイルのimportを適切に追加してください。  
この修正に関する質問は受け付けできません。  
プルリク歓迎ですが、フルスクラッチで作った方がいいものができそうに思います。  

```
compile 'org.twitter4j:twitter4j-core:4.0.4'
compile 'org.twitter4j:twitter4j-async:4.0.4'
```

### 所感
実運用したところ、自動ツイートはなくても信号待ち等であまり問題なく運用できることが分かりました。(ただし意識が朦朧としていると更新タイミングを逃します)  
ちなみにぽちっとボタンを押せば一瞬で貯金がわかるので、挑戦者自身が状況を把握するのに超便利でした。  
このアプリがなければパンクしたときに諦めていたかもしれません。  
  
バッテリーの持ちを重視してGPSのチェックを3分ごとにしましたが、GPSを起動してたかだか50個程度ループを回すだけなので、このアプリによるバッテリー消費は微々たるものと思われます。  
むしろ半径1キロでは誤差が大きいので、1分ごとに半径500mくらいでチェックした方がバランスが取れそうだと感じています。(とりあえずキャノボで使った設定から変更していません)  
なんか山の上だと到着時刻の判定が早くなる気がしましたが、単純に移動速度が遅いせいかも知れません。  
  
csvやjsonの読み出しくらいは対応しないとapkも配れないので、そのくらいは何とかしたいと思います。  
できればクラウドに設定をアップロードする機能も付けたいところです。  
もしも自動ツイートを実装するとしても、半手動と選択可能な機能にすることでしょう。実装するか分かりません。  

### 戯言
最近ではキャノンボール挑戦中にGoogleのGPSを公開してくださる方もおられますが、状況を確認するためにはツイートをたどって公開ページのリンクをたどり、地図上で距離と残り時間を計算しないといけないことがストレスでした。  
もちろんキャノボのコースを熟知している方は地図を見ただけですぐに分かるのでしょうが、私のように不勉強な『観客』はぱっと見では状況が分かりません。  

他のキャノボ挑戦者やその周囲の開発者がより良いアプリを開発し、挑戦者の負担なくリアルタイムに情報が共有できる仕組みができれば望外の喜びです。  
ライセンスは今後改良したときにMITライセンスあたりで整備します。  
